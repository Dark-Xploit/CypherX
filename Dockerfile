FROM node:lts

# Install dependencies
RUN apt-get update && apt-get install -y --no-install-recommends ffmpeg imagemagick webp && apt-get clean

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json FROM node:lts

# Install dependencies
RUN apt-get update && apt-get install -y --no-install-recommends ffmpeg imagemagick webp && apt-get clean

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install && npm cache clean --force

# Copy application code
COPY .eyJub2lzZUtleSI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiUU9YQXpkamxIZHpGdFZMaUZVVnZwdjhaMyszVkQ3M3YxcEkxZzRmSm9tQT0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoic0NOeTBUYXFyYmV0ZFREcWh1OUowdGVLVytDVlA5RmtIbFpKSHRoT3dGdz0ifX0sInBhaXJpbmdFcGhlbWVyYWxLZXlQYWlyIjp7InByaXZhdGUiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJnTjRYRFZUalhNcXZ6SktWWlNQTXl6ZzhTV2l5WXZ1RUl1TUNLRDg4R2tRPSJ9LCJwdWJsaWMiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiIyUExWRVlRTTJmaVUzMVFJVFV1bVZuWkhQTkp2VTEybkN5OExiNnRwRGpVPSJ9fSwic2lnbmVkSWRlbnRpdHlLZXkiOnsicHJpdmF0ZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6Ik9KS0lZSlQ1SXRZbmtYYnZlUGtFVDczcXkzUEczNmIxaWpibERhOXoxblE9In0sInB1YmxpYyI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6IjJDTEV1RDF4WEVSdHY3TDVybFJSY0xtcU5rWTYwVWVlYXJ5a2tkL21FMTg9In19LCJzaWduZWRQcmVLZXkiOnsia2V5UGFpciI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiQUdTN0FrOGY1UG9hY1JrYnJJSHJpR2ZoTlRXVUNTSGNTYXZnTktEdWFGbz0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiZmZ0RzQ2eEgwUGxzR0xqcHVWMzJxKzdYTUE2emdHU29rV05zWkNDQjMydz0ifX0sInNpZ25hdHVyZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6InRmbXJieDBNTG1qVlUvdTVPeUlUOVBMMXBQaUpBYzBqNHZFUWpWWWVKUExJNERVc0lPeE5paXZQWnFWSlBOa0pvNk5sWGlnNFNXWEUvdGowZEY0M2p3PT0ifSwia2V5SWQiOjF9LCJyZWdpc3RyYXRpb25JZCI6MjE5LCJhZHZTZWNyZXRLZXkiOiJBVW5sWHhwNnA4S09aanFMM2ExazRvdUl2bURvUStYRk0rMnJXcmVxNkhzPSIsInByb2Nlc3NlZEhpc3RvcnlNZXNzYWdlcyI6W3sia2V5Ijp7InJlbW90ZUppZCI6IjI1NDc1ODEyNzkyOEBzLndoYXRzYXBwLm5ldCIsImZyb21NZSI6dHJ1ZSwiaWQiOiJBQ0NFRDRGM0Y3NTA5NTEzRjU5RDg4MkRFQkM5NEYxRCJ9LCJtZXNzYWdlVGltZXN0YW1wIjoxNzYwMDE4NzEzfSx7ImtleSI6eyJyZW1vdGVKaWQiOiIyNTQ3NTgxMjc5MjhAcy53aGF0c2FwcC5uZXQiLCJmcm9tTWUiOnRydWUsImlkIjoiQUM1MjlDQjQ0NTU4QkQ3OEJCMTExRjk0MjYwREY5NUMifSwibWVzc2FnZVRpbWVzdGFtcCI6MTc2MDAxODcxNH0seyJrZXkiOnsicmVtb3RlSmlkIjoiMjU0NzU4MTI3OTI4QHMud2hhdHNhcHAubmV0IiwiZnJvbU1lIjp0cnVlLCJpZCI6IkFDQjlCMTZFNzYxMkJDOTZGQzJCRjkzMDZENkU1OTQxIn0sIm1lc3NhZ2VUaW1lc3RhbXAiOjE3NjAwMTg3MTh9XSwibmV4dFByZUtleUlkIjozMSwiZmlyc3RVbnVwbG9hZGVkUHJlS2V5SWQiOjMxLCJhY2NvdW50U3luY0NvdW50ZXIiOjEsImFjY291bnRTZXR0aW5ncyI6eyJ1bmFyY2hpdmVDaGF0cyI6ZmFsc2V9LCJyZWdpc3RlcmVkIjp0cnVlLCJwYWlyaW5nQ29kZSI6IlYyNUE3WEVFIiwibWUiOnsiaWQiOiIyNTQ3NTgxMjc5Mjg6NUBzLndoYXRzYXBwLm5ldCIsImxpZCI6IjYwNjk3MjMyODE0MDgwOjVAbGlkIiwibmFtZSI6IkFzc2Fzc2luIPCfqpYifSwiYWNjb3VudCI6eyJkZXRhaWxzIjoiQ0pIcXJyQUVFSWFDbjhjR0dBRWdBQ2dBIiwiYWNjb3VudFNpZ25hdHVyZUtleSI6IkVpb1JlUmNwMW50dDAyblQ3NFIzbHkxY2FJUmFtN3BHei93N3JIS3lVRms9IiwiYWNjb3VudFNpZ25hdHVyZSI6IldDN2xPTC9RWUxVdzdCRG01bGUySERmdWtkblRDM2xCUHJ1cUlxQktGazdKY1dhRXVVSVhNU3M2WEZINWwrbm1ZRHY5TlQ5OEp0Z0JvdDBQRjlZTEJ3PT0iLCJkZXZpY2VTaWduYXR1cmUiOiJEbzdhNmVBRVRvbmg0bllHMXFLS3pxdDlPRTZ0R0oyUUVEMnk0YzdxdVJvbnVTZ2ZXVEJqenljaTRPcTFQbnVLRGdWMEEvTTJxU2dRcDZ0SFdKYy9oUT09In0sInNpZ25hbElkZW50aXRpZXMiOlt7ImlkZW50aWZpZXIiOnsibmFtZSI6IjI1NDc1ODEyNzkyODo1QHMud2hhdHNhcHAubmV0IiwiZGV2aWNlSWQiOjB9LCJpZGVudGlmaWVyS2V5Ijp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiQlJJcUVYa1hLZFo3YmROcDArK0VkNWN0WEdpRVdwdTZScy84TzZ4eXNsQloifX1dLCJwbGF0Zm9ybSI6ImFuZHJvaWQiLCJyb3V0aW5nSW5mbyI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6IkNCSUlCUT09In0sImxhc3RBY2NvdW50U3luY1RpbWVzdGFtcCI6MTc2MDAxODcwOCwibGFzdFByb3BIYXNoIjoiMUs0aEg0IiwibXlBcHBTdGF0ZUtleUlkIjoiQUFBQUFGYjcifQ==
.

# Expose port
EXPOSE 3000

# Set environment
ENV NODE_ENV production

# Run command
CMD ["npm", "run", "start"]./

# Install dependencies
RUN npm install && npm cache clean --force

# Copy application code
COPY . .

# Expose port
EXPOSE 3000

# Set environment
ENV NODE_ENV production

# Run command
CMD ["npm", "run", "start"]
